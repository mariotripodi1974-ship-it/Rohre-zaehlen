<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rohr-Zähler</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;margin:0;padding:16px;}
    h1{font-size:20px;margin:0 0 8px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 320px;min-width:280px}
    .card{border:1px solid #ddd;border-radius:12px;padding:12px}
    label{display:block;margin:6px 0 2px;font-size:13px;color:#333}
    input[type="range"],input[type="number"]{width:100%}
    button{padding:10px 12px;border-radius:10px;border:1px solid #ccc;background:#fff;cursor:pointer}
    button.primary{background:#0b5cff;color:#fff;border-color:#0b5cff}
    #preview,#out{width:100%;max-height:60vh;object-fit:contain;background:#111;border-radius:8px}
    video{width:100%;max-height:50vh;background:#000;border-radius:8px}
    .hint{color:#666;font-size:12px}
  </style>
</head>
<body>
  <h1>Rohr-Zähler (Zielgröße)</h1>
  <p class="hint">Foto laden oder Kamera nutzen → Ziel-Radius &amp; Toleranz einstellen → Zählen. Export als PNG/CSV.</p>

  <div class="row">
    <div class="col card">
      <label>Bildquelle</label>
      <input id="file" type="file" accept="image/*;capture=camera">
      <div style="margin:8px 0;display:flex;gap:8px;flex-wrap:wrap">
        <button id="openCam">Kamera öffnen</button>
        <button id="snap">Foto aufnehmen</button>
        <button id="stopCam">Kamera stoppen</button>
      </div>
      <video id="video" playsinline muted></video>
      <canvas id="canvas" style="display:none"></canvas>
      <img id="preview" alt="Vorschau" />
    </div>

    <div class="col card">
      <div class="row">
        <div class="col">
          <label>Ziel-Radius (Pixel) – 0 = Auto</label>
          <input id="targetR" type="number" min="0" max="800" step="1" value="0">
        </div>
        <div class="col">
          <label>Toleranz (%)</label>
          <input id="tolPct" type="range" min="1" max="30" step="1" value="8">
          <div><span id="tolLbl">8</span>%</div>
        </div>
      </div>

      <details style="margin-top:8px">
        <summary>Erweitert</summary>
        <label>dp</label>
        <input id="dp" type="range" min="0.5" max="3.0" step="0.1" value="1.2">
        <label>minDist (0=auto)</label>
        <input id="minDist" type="range" min="0" max="400" step="1" value="0">
        <label>param1 (Canny)</label>
        <input id="param1" type="range" min="10" max="300" step="1" value="120">
        <label>param2 (Schwelle)</label>
        <input id="param2" type="range" min="5" max="200" step="1" value="20">
        <label>minRadius (Std-Modus)</label>
        <input id="minR" type="range" min="1" max="600" step="1" value="10">
        <label>maxRadius (Std-Modus)</label>
        <input id="maxR" type="range" min="5" max="800" step="1" value="120">
        <div style="margin-top:6px">
          <label><input id="useClahe" type="checkbox" checked> CLAHE (Kontrast)</label>
          <label><input id="useBlur" type="checkbox" checked> Weichzeichnen</label>
        </div>
      </details>

      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="primary" id="countBtn">Zählen</button>
        <button id="savePng">Annotiertes PNG</button>
        <button id="saveCsv">CSV exportieren</button>
      </div>
      <div id="status" class="hint" style="margin-top:6px">Bereit.</div>
      <img id="out" alt="Ergebnis" />
    </div>
  </div>

  <script>
    // HINWEIS: Skript wird später hinzugefügt
    alert("App geladen – bitte OpenCV.js-Code nachliefern!");
  </script>
</body>
</html>
